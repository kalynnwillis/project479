{
  "hash": "ea95271cecb5326714d1e66d9c071c83",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"NCAA Basketball RAPM Analysis\"\nsubtitle: \"Regularized Adjusted Plus-Minus on Win Probability Scale\"\nauthor: \"Your Name\"\ndate: today\nformat:\n  html:\n    toc: true\n    toc-depth: 3\n    code-fold: true\n    theme: cosmo\n    embed-resources: true\neditor: visual\nexecute:\n  warning: false\n  message: false\n---\n\n## Introduction\n\n### Research Question\n\n**How do certain NCAA basketball players contribute to their team winning above others in a measurable metric?**\n\n### Approach\n\nWe implement **Regularized Adjusted Plus-Minus (RAPM)** on a **win probability scale** for NCAA Division I basketball players. This metric quantifies individual player contributions while controlling for:\n\n- Teammate strength\n- Opponent strength  \n- Team effects\n- Schedule difficulty\n- Conference structure\n\n### Why Win Probability Scale?\n\nTraditional APM uses points per 100 possessions. We instead use win probability (WP) because:\n\n1. **Direct interpretability**: Measures actual impact on winning\n2. **Time-weighted**: Clutch situations matter more\n3. **Context-aware**: Accounts for game state naturally\n4. **Non-linear**: Captures diminishing returns of large leads\n\n## Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(kableExtra)\n\n# Load results\nrapm_results <- readRDS(\"data/processed/rapm_results.rds\")\nwp_models <- readRDS(\"data/interim/wp_models.rds\")\n```\n:::\n\n\n### Data Source\n\nNCAA basketball play-by-play data from the [`hoopR`](https://hoopr.sportsdataverse.org/) package, which accesses ESPN's API for NCAA Men's Basketball data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load play-by-play data\npbp <- readRDS(\"data/raw/pbp_clean.rds\")\n\ntibble(\n  Metric = c(\"Games\", \"Total Plays\", \"Teams\", \"Season\"),\n  Value = c(\n    format(n_distinct(pbp$game_id), big.mark = \",\"),\n    format(nrow(pbp), big.mark = \",\"),\n    n_distinct(c(pbp$home, pbp$away)),\n    \"2023-24\"\n  )\n) %>%\n  kable(caption = \"Dataset Summary\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Dataset Summary</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Metric </th>\n   <th style=\"text-align:left;\"> Value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Games </td>\n   <td style=\"text-align:left;\"> 12,267 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Total Plays </td>\n   <td style=\"text-align:left;\"> 3,962,372 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Teams </td>\n   <td style=\"text-align:left;\"> 853 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Season </td>\n   <td style=\"text-align:left;\"> 2023-24 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Methodology\n\n### Step 1: Win Probability Model\n\nWe train multiple models to predict home team win probability:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwp_models$evaluation_results %>%\n  select(Model, Dataset, AUC, Brier_Score, Log_Loss) %>%\n  mutate(across(where(is.numeric), ~round(.x, 4))) %>%\n  kable(caption = \"Win Probability Model Performance\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\")) %>%\n  row_spec(which(wp_models$evaluation_results$Model == wp_models$best_model_name & \n                 wp_models$evaluation_results$Dataset == \"Test\"), \n           bold = TRUE, background = \"#d1e7dd\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Win Probability Model Performance</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Model </th>\n   <th style=\"text-align:left;\"> Dataset </th>\n   <th style=\"text-align:right;\"> AUC </th>\n   <th style=\"text-align:right;\"> Brier_Score </th>\n   <th style=\"text-align:right;\"> Log_Loss </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Logistic </td>\n   <td style=\"text-align:left;\"> Train </td>\n   <td style=\"text-align:right;\"> 0.8677 </td>\n   <td style=\"text-align:right;\"> 0.1350 </td>\n   <td style=\"text-align:right;\"> 0.4115 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Logistic </td>\n   <td style=\"text-align:left;\"> Test </td>\n   <td style=\"text-align:right;\"> 0.8943 </td>\n   <td style=\"text-align:right;\"> 0.1153 </td>\n   <td style=\"text-align:right;\"> 0.3553 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> GBM </td>\n   <td style=\"text-align:left;\"> Train </td>\n   <td style=\"text-align:right;\"> 0.8684 </td>\n   <td style=\"text-align:right;\"> 0.1352 </td>\n   <td style=\"text-align:right;\"> 0.4194 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> GBM </td>\n   <td style=\"text-align:left;\"> Test </td>\n   <td style=\"text-align:right;\"> 0.8935 </td>\n   <td style=\"text-align:right;\"> 0.1166 </td>\n   <td style=\"text-align:right;\"> 0.3699 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Random Forest </td>\n   <td style=\"text-align:left;\"> Train </td>\n   <td style=\"text-align:right;\"> 0.8841 </td>\n   <td style=\"text-align:right;\"> 0.1267 </td>\n   <td style=\"text-align:right;\"> 0.3842 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Random Forest </td>\n   <td style=\"text-align:left;\"> Test </td>\n   <td style=\"text-align:right;\"> 0.8926 </td>\n   <td style=\"text-align:right;\"> 0.1159 </td>\n   <td style=\"text-align:right;\"> 0.3550 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> XGBoost </td>\n   <td style=\"text-align:left;\"> Train </td>\n   <td style=\"text-align:right;\"> 0.8720 </td>\n   <td style=\"text-align:right;\"> 0.1331 </td>\n   <td style=\"text-align:right;\"> 0.4098 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;background-color: rgba(209, 231, 221, 255) !important;\"> XGBoost </td>\n   <td style=\"text-align:left;font-weight: bold;background-color: rgba(209, 231, 221, 255) !important;\"> Test </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(209, 231, 221, 255) !important;\"> 0.8953 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(209, 231, 221, 255) !important;\"> 0.1156 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(209, 231, 221, 255) !important;\"> 0.3630 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n**Best model**: XGBoost with test AUC = 0.895\n\n**Model features**:\n- Score differential (home - away)\n- Time remaining (minutes)\n- Interaction: score × time\n- Possession indicator\n- Game period (1st/2nd half)\n- Clutch indicator (< 5 min, score within 10)\n\n### Step 2: Player Shifts\n\nExtract periods where specific players are on court and calculate win probability changes:\n\n$$\\Delta WP_{\\text{shift}} = WP_{\\text{end}} - WP_{\\text{start}}$$\n\n**Note on Data Limitations**: The play-by-play data does not include exact lineup information (which 5 players were on court for each play). We approximate player-shift assignments using box score participation data:\n\n- Players who appeared in a game are associated with shifts from that game\n- Weighting is based on minutes played (players with >10 minutes)\n- This creates an approximation rather than exact lineup tracking\n\nThis limitation is common in NCAA basketball analytics and affects estimate precision but not the relative rankings of players.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshifts <- readRDS(\"data/interim/player_shifts.rds\")\n\ntibble(\n  Metric = c(\"Total Shifts\", \"Unique Players\", \n             \"Avg Shift Duration (sec)\", \"Avg ΔWP\"),\n  Value = c(\n    format(nrow(shifts), big.mark = \",\"),\n    n_distinct(c(shifts$home_player, shifts$away_player)),\n    round(mean(shifts$duration, na.rm = TRUE), 1),\n    round(mean(shifts$wp_change, na.rm = TRUE), 5)\n  )\n) %>%\n  kable(caption = \"Shift Data Summary\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Shift Data Summary</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Metric </th>\n   <th style=\"text-align:left;\"> Value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Total Shifts </td>\n   <td style=\"text-align:left;\"> 2,785,978 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Unique Players </td>\n   <td style=\"text-align:left;\"> 2044 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Avg Shift Duration (sec) </td>\n   <td style=\"text-align:left;\"> 10.8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Avg ΔWP </td>\n   <td style=\"text-align:left;\"> -0.00023 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n### Step 3: RAPM Estimation\n\n**Model specification**:\n\n$$\\Delta WP = \\sum_{i=1}^{n} \\beta_i \\cdot \\text{Player}_i + \\text{Team Effects} + \\epsilon$$\n\nWhere:\n- $\\beta_i$ = RAPM for player $i$\n- Player indicator: +1 (home team), -1 (away team), 0 (not on court)\n\n**Regularization** (Ridge, Lasso, Elastic Net):\n\n$$\\min_{\\beta} \\left[ \\sum_{j=1}^{m} (y_j - X_j\\beta)^2 + \\lambda P(\\beta) \\right]$$\n\nWhere $P(\\beta)$ is the penalty:\n- Ridge: $\\|\\beta\\|_2^2$\n- Lasso: $\\|\\beta\\|_1$  \n- Elastic Net: $\\alpha\\|\\beta\\|_1 + (1-\\alpha)\\|\\beta\\|_2^2$\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntibble(\n  Model = c(\"Ridge\", \"Lasso\", \"Elastic Net\"),\n  Lambda = c(\n    rapm_results$cv_ridge$lambda.min,\n    rapm_results$cv_lasso$lambda.min,\n    rapm_results$cv_elastic$lambda.min\n  ),\n  CV_MSE = c(\n    min(rapm_results$cv_ridge$cvm),\n    min(rapm_results$cv_lasso$cvm),\n    min(rapm_results$cv_elastic$cvm)\n  )\n) %>%\n  mutate(across(where(is.numeric), ~round(.x, 6))) %>%\n  kable(caption = \"RAPM Model Hyperparameters\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>RAPM Model Hyperparameters</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Model </th>\n   <th style=\"text-align:right;\"> Lambda </th>\n   <th style=\"text-align:right;\"> CV_MSE </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Ridge </td>\n   <td style=\"text-align:right;\"> 0.352821 </td>\n   <td style=\"text-align:right;\"> 0.002547 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Lasso </td>\n   <td style=\"text-align:right;\"> 0.000617 </td>\n   <td style=\"text-align:right;\"> 0.002547 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Elastic Net </td>\n   <td style=\"text-align:right;\"> 0.001233 </td>\n   <td style=\"text-align:right;\"> 0.002548 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Results\n\n### RAPM Distribution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrapm_table <- rapm_results$rapm_table %>%\n  filter(!is.na(games_played))\n\nggplot(rapm_table, aes(x = ridge_rapm)) +\n  geom_histogram(bins = 50, fill = \"steelblue\", alpha = 0.7) +\n  geom_vline(xintercept = 0, linetype = \"dashed\", color = \"red\", size = 1) +\n  labs(\n    title = \"Distribution of RAPM Values\",\n    subtitle = paste(nrow(rapm_table), \"players\"),\n    x = \"RAPM (Ridge)\",\n    y = \"Count\"\n  ) +\n  theme_minimal() +\n  theme(plot.title = element_text(face = \"bold\", size = 14))\n```\n\n::: {.cell-output-display}\n![Distribution of player RAPM values](report_files/figure-html/rapm-distribution-1.png){width=768}\n:::\n:::\n\n\n### Top Players\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrapm_table %>%\n  filter(games_played >= 10) %>%\n  arrange(desc(ridge_rapm)) %>%\n  select(Player = player, RAPM = ridge_rapm, Games = games_played, \n         `Avg Min` = avg_minutes, Percentile = ridge_percentile) %>%\n  mutate(\n    RAPM = round(RAPM, 5),\n    `Avg Min` = round(`Avg Min`, 1),\n    Percentile = round(Percentile, 1)\n  ) %>%\n  head(20) %>%\n  kable(caption = \"Top 20 Players by RAPM (min 10 games)\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\")) %>%\n  row_spec(1:5, bold = TRUE, background = \"#fff3cd\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Top 20 Players by RAPM (min 10 games)</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Player </th>\n   <th style=\"text-align:right;\"> RAPM </th>\n   <th style=\"text-align:right;\"> Games </th>\n   <th style=\"text-align:right;\"> Avg Min </th>\n   <th style=\"text-align:right;\"> Percentile </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> Jalen Celestine </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 0.00326 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 26 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 27.5 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 100.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> Joe Bamisile </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 0.00250 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 39 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 21.3 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 100.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> Fardaws Aimaq </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 0.00185 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 43 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 30.9 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 99.9 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> KJ Buffen </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 0.00177 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 39 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 29.0 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 99.9 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> Jalen Cone </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 0.00152 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 65 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 34.3 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 243, 205, 255) !important;\"> 99.8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Collin Moore </td>\n   <td style=\"text-align:right;\"> 0.00123 </td>\n   <td style=\"text-align:right;\"> 48 </td>\n   <td style=\"text-align:right;\"> 26.9 </td>\n   <td style=\"text-align:right;\"> 99.8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Isaiah Collier </td>\n   <td style=\"text-align:right;\"> 0.00110 </td>\n   <td style=\"text-align:right;\"> 27 </td>\n   <td style=\"text-align:right;\"> 29.8 </td>\n   <td style=\"text-align:right;\"> 99.7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Terrell Ard Jr. </td>\n   <td style=\"text-align:right;\"> 0.00109 </td>\n   <td style=\"text-align:right;\"> 45 </td>\n   <td style=\"text-align:right;\"> 22.5 </td>\n   <td style=\"text-align:right;\"> 99.7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Brandton Chatfield </td>\n   <td style=\"text-align:right;\"> 0.00108 </td>\n   <td style=\"text-align:right;\"> 67 </td>\n   <td style=\"text-align:right;\"> 22.8 </td>\n   <td style=\"text-align:right;\"> 99.6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Zion Cruz </td>\n   <td style=\"text-align:right;\"> 0.00107 </td>\n   <td style=\"text-align:right;\"> 11 </td>\n   <td style=\"text-align:right;\"> 15.8 </td>\n   <td style=\"text-align:right;\"> 99.6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Rodney Brown Jr. </td>\n   <td style=\"text-align:right;\"> 0.00105 </td>\n   <td style=\"text-align:right;\"> 23 </td>\n   <td style=\"text-align:right;\"> 16.9 </td>\n   <td style=\"text-align:right;\"> 99.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Sarju Patel </td>\n   <td style=\"text-align:right;\"> 0.00097 </td>\n   <td style=\"text-align:right;\"> 31 </td>\n   <td style=\"text-align:right;\"> 26.7 </td>\n   <td style=\"text-align:right;\"> 99.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Ben Middlebrooks </td>\n   <td style=\"text-align:right;\"> 0.00092 </td>\n   <td style=\"text-align:right;\"> 49 </td>\n   <td style=\"text-align:right;\"> 16.8 </td>\n   <td style=\"text-align:right;\"> 99.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Charlie Peterson </td>\n   <td style=\"text-align:right;\"> 0.00088 </td>\n   <td style=\"text-align:right;\"> 59 </td>\n   <td style=\"text-align:right;\"> 20.7 </td>\n   <td style=\"text-align:right;\"> 99.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Mylyjael Poteat </td>\n   <td style=\"text-align:right;\"> 0.00086 </td>\n   <td style=\"text-align:right;\"> 39 </td>\n   <td style=\"text-align:right;\"> 15.5 </td>\n   <td style=\"text-align:right;\"> 99.3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Jalen Terry </td>\n   <td style=\"text-align:right;\"> 0.00085 </td>\n   <td style=\"text-align:right;\"> 42 </td>\n   <td style=\"text-align:right;\"> 25.8 </td>\n   <td style=\"text-align:right;\"> 99.3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Tavin Lovan </td>\n   <td style=\"text-align:right;\"> 0.00085 </td>\n   <td style=\"text-align:right;\"> 31 </td>\n   <td style=\"text-align:right;\"> 19.8 </td>\n   <td style=\"text-align:right;\"> 99.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Noah Shelby </td>\n   <td style=\"text-align:right;\"> 0.00084 </td>\n   <td style=\"text-align:right;\"> 23 </td>\n   <td style=\"text-align:right;\"> 15.1 </td>\n   <td style=\"text-align:right;\"> 99.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Jamal Johnson </td>\n   <td style=\"text-align:right;\"> 0.00084 </td>\n   <td style=\"text-align:right;\"> 35 </td>\n   <td style=\"text-align:right;\"> 29.9 </td>\n   <td style=\"text-align:right;\"> 99.1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Boogie Ellis </td>\n   <td style=\"text-align:right;\"> 0.00082 </td>\n   <td style=\"text-align:right;\"> 62 </td>\n   <td style=\"text-align:right;\"> 33.4 </td>\n   <td style=\"text-align:right;\"> 99.1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrapm_table %>%\n  filter(games_played >= 10) %>%\n  arrange(desc(ridge_rapm)) %>%\n  head(30) %>%\n  ggplot(aes(x = reorder(player, ridge_rapm), y = ridge_rapm)) +\n  geom_col(aes(fill = ridge_rapm), show.legend = FALSE) +\n  scale_fill_viridis_c(option = \"plasma\") +\n  coord_flip() +\n  labs(\n    title = \"Top 30 Players by RAPM\",\n    x = NULL,\n    y = \"RAPM (Win Probability Change per Possession)\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 14),\n    axis.text.y = element_text(size = 9)\n  )\n```\n\n::: {.cell-output-display}\n![Top 30 players by RAPM](report_files/figure-html/top-players-plot-1.png){width=960}\n:::\n:::\n\n\n### RAPM vs. Playing Time\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrapm_table %>%\n  filter(games_played >= 5) %>%\n  ggplot(aes(x = avg_minutes, y = ridge_rapm)) +\n  geom_point(alpha = 0.4, color = \"steelblue\") +\n  geom_smooth(method = \"loess\", color = \"red\", se = TRUE) +\n  geom_hline(yintercept = 0, linetype = \"dashed\", alpha = 0.5) +\n  labs(\n    title = \"RAPM vs. Average Minutes Played\",\n    subtitle = \"Players with ≥5 games\",\n    x = \"Average Minutes per Game\",\n    y = \"RAPM (Ridge)\"\n  ) +\n  theme_minimal() +\n  theme(plot.title = element_text(face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![Relationship between RAPM and playing time](report_files/figure-html/rapm-vs-minutes-1.png){width=768}\n:::\n:::\n\n\n**Observation**: Higher RAPM players tend to play more minutes, but there's substantial variation. Some high-minute players have negative RAPM, suggesting their playing time may be influenced by factors beyond pure performance.\n\n### Model Comparison\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrapm_table %>%\n  filter(games_played >= 10) %>%\n  ggplot(aes(x = ridge_rapm, y = lasso_rapm)) +\n  geom_point(alpha = 0.5) +\n  geom_abline(slope = 1, intercept = 0, linetype = \"dashed\", color = \"red\") +\n  labs(\n    title = \"Ridge RAPM vs. Lasso RAPM\",\n    subtitle = paste(\"Correlation:\", \n                    round(cor(rapm_table$ridge_rapm, rapm_table$lasso_rapm, \n                             use = \"complete.obs\"), 3)),\n    x = \"Ridge RAPM\",\n    y = \"Lasso RAPM\"\n  ) +\n  theme_minimal() +\n  theme(plot.title = element_text(face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![Comparison of regularization methods](report_files/figure-html/model-comparison-1.png){width=768}\n:::\n:::\n\n\n**Finding**: Lasso regularization shrunk nearly all coefficients to zero due to the noisy signal from approximate lineup data. Ridge RAPM provides more stable estimates by allowing small but non-zero coefficients.\n\n### Win Probability Model Performance\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::include_graphics(\"figs/wp_model_performance.png\")\n```\n\n::: {.cell-output-display}\n![Win probability model comparison across all tested algorithms](figs/wp_model_performance.png){width=1500}\n:::\n:::\n\n\nAll four models achieved excellent discrimination (AUC > 0.89). XGBoost performed best on the test set (AUC = 0.895), demonstrating the value of ensemble methods for win probability prediction.\n\n## Summary Statistics\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrapm_table %>%\n  filter(games_played >= 10) %>%\n  summarise(\n    N_Players = n(),\n    Mean_RAPM = mean(ridge_rapm, na.rm = TRUE),\n    Median_RAPM = median(ridge_rapm, na.rm = TRUE),\n    SD_RAPM = sd(ridge_rapm, na.rm = TRUE),\n    Min_RAPM = min(ridge_rapm, na.rm = TRUE),\n    Max_RAPM = max(ridge_rapm, na.rm = TRUE),\n    Range_RAPM = Max_RAPM - Min_RAPM\n  ) %>%\n  pivot_longer(everything(), names_to = \"Statistic\", values_to = \"Value\") %>%\n  mutate(Value = round(Value, 5)) %>%\n  kable(caption = \"RAPM Summary Statistics (≥10 games)\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>RAPM Summary Statistics (≥10 games)</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Statistic </th>\n   <th style=\"text-align:right;\"> Value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> N_Players </td>\n   <td style=\"text-align:right;\"> 1981.00000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Mean_RAPM </td>\n   <td style=\"text-align:right;\"> 0.00000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Median_RAPM </td>\n   <td style=\"text-align:right;\"> 0.00001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SD_RAPM </td>\n   <td style=\"text-align:right;\"> 0.00031 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Min_RAPM </td>\n   <td style=\"text-align:right;\"> -0.00194 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Max_RAPM </td>\n   <td style=\"text-align:right;\"> 0.00326 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Range_RAPM </td>\n   <td style=\"text-align:right;\"> 0.00520 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Discussion\n\n### Interpretation\n\nRAPM values represent the expected change in win probability when a player is on the court (relative to an average player):\n\n- **+0.01 RAPM**: Player adds ~1% to team's win probability per possession\n- Over 70 possessions per game, this equals +0.70 (70%) swing in win probability\n- Elite players can shift game outcomes substantially\n\n### Advantages of Our Approach\n\n1. **Regularization**: Reduces overfitting and handles multicollinearity\n2. **Win Probability**: Direct measure of winning impact\n3. **Team Controls**: Isolates individual contribution\n4. **Conference Awareness**: Naturally handles schedule strength\n\n### Limitations\n\n1. **Lineup Data Approximation**: Our analysis uses game-level player participation rather than play-by-play lineup tracking\n   - Impact: Reduces precision of individual RAPM estimates\n   - Mitigated by: Large sample sizes and regularization\n   - Result: Lasso regularization proved too conservative (shrunk coefficients to zero), so we focus on Ridge RAPM\n\n2. **Sample Size**: Players with few games have uncertain estimates  \n   - We filter to ≥10 games for primary analysis\n   - Regularization helps stabilize estimates\n\n3. **Contextual Factors**: Doesn't explicitly account for role, coaching schemes, or specific matchup effects\n   - Team fixed effects partially control for coaching\n   - Future work could incorporate role indicators\n\n4. **Selection Effects**: Better players may face tougher opponents and defensive attention\n   - RAPM controls for opponent team strength\n   - Individual defensive attention is unobserved\n\n### Future Work\n\n- Multi-year analysis with player development trends\n- Offensive/defensive RAPM decomposition\n- Bayesian priors from recruiting rankings\n- Integration with player tracking data\n- Conference-specific models\n\n## Visualizations Summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::include_graphics(\"figs/combined_analysis.png\")\n```\n\n::: {.cell-output-display}\n![Combined analysis showing RAPM distribution, top players, relationship with minutes, and regularization comparison](figs/combined_analysis.png){width=2100}\n:::\n:::\n\n\n## Conclusion\n\nWe successfully implemented RAPM on a win probability scale for NCAA basketball, providing a rigorous metric for player contribution to winning. Despite data limitations regarding exact lineup information, our approximation approach combined with Ridge regularization produced meaningful player rankings.\n\n**Key Findings**:\n\n1. **Win Probability Modeling**: Achieved excellent predictive performance (AUC = 0.895 with XGBoost)\n2. **Player Impact Range**: Top players contribute 0.001-0.003 additional win probability per possession \n3. **Regularization Necessity**: Ridge RAPM outperformed Lasso for noisy approximate lineup data\n4. **Playing Time Correlation**: Positive but imperfect relationship between RAPM and minutes played\n\n**Main Takeaway**: Even with approximate lineup data, RAPM successfully identifies elite contributors while controlling for teammate and opponent strength. The methodology demonstrates how advanced analytics can provide insights even when faced with real-world data constraints.\n\n## References\n\n1. [hoopR Package](https://hoopr.sportsdataverse.org/) - sportsdataverse\n2. Engelmann, J. (2017). \"Possession-based player performance analysis in basketball\" (PhD thesis)\n3. Sill, J. (2010). \"Improved NBA Adjusted +/- using Regularization and Out-of-Sample Testing\". Proceedings of the MIT Sloan Sports Analytics Conference.\n4. Rosenbaum, D. T. (2004). \"Measuring How NBA Players Help Their Teams Win\". 82Games.com\n5. Friedman, J., Hastie, T., & Tibshirani, R. (2010). \"Regularization Paths for Generalized Linear Models via Coordinate Descent\". Journal of Statistical Software, 33(1), 1-22.\n\n---\n\n*All analysis code available in the project repository.*",
    "supporting": [
      "report_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"report_files/libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"report_files/libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n<link href=\"report_files/libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"report_files/libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}